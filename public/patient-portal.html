<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Portal - Zahari Medical Clinical</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header (same as index.html but with different active link) -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <a href="index.html">
                    <div class="logo-container">
                        <img src="assets/logo1.png" alt="Zahari Medical Logo" class="logo-img">
                        <h1>Zahari Medical</h1>
                    </div>
                </a>
            </div>

            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="services.html">Services</a></li>
                    <li><a href="doctors.html">Doctors</a></li>
                    <li><a href="patient-portal.html" class="active">Patient Portal</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>

            <div class="header-actions">
                <a href="appointment.html" class="btn btn-primary">
                    <i class="fas fa-calendar-check"></i> Appointment
                </a>
            </div>

            <button class="mobile-menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Patient Portal Hero -->
    <section class="page-hero portal-hero">
        <div class="container">
            <h1>Patient Portal</h1>
            <p>Secure access to your health information</p>
        </div>
    </section>

    <!-- Patient Portal Main Content -->
    <main class="page-content">
        <div class="container">
            <!-- Login/Signup Toggle -->
            <div class="portal-toggle">
                <button class="toggle-btn active" id="loginToggle">Login</button>
                <button class="toggle-btn" id="signupToggle">Register</button>
            </div>

            <!-- Login Form -->
            <div class="portal-form active" id="loginForm">
                <div class="form-header">
                    <h2>Sign In to Your Account</h2>
                    <p>Access your medical records and appointments</p>
                </div>

                <form id="patientLoginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email Address</label>
                        <input type="email" id="loginEmail" required>
                    </div>

                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <div class="password-input">
                            <input type="password" id="loginPassword" required>
                            <button type="button" class="show-password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <a href="#forgot-password" class="forgot-password">Forgot password?</a>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">Sign In</button>

                    <div class="social-login">
                        <p>Or sign in with:</p>
                        <div class="social-buttons">
                            <button type="button" class="btn btn-social google">
                                <i class="fab fa-google"></i> Google
                            </button>
                            <button type="button" class="btn btn-social facebook">
                                <i class="fab fa-facebook-f"></i> Facebook
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Registration Form -->
            <div class="portal-form" id="signupForm">
                <div class="form-header">
                    <h2>Create Your Account</h2>
                    <p>Register to access our patient portal services</p>
                </div>

                <form id="patientSignupForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">First Name</label>
                            <input type="text" id="firstName" required>
                        </div>
                        <div class="form-group">
                            <label for="lastName">Last Name</label>
                            <input type="text" id="lastName" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="signupEmail">Email Address</label>
                        <input type="email" id="signupEmail" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="signupPassword">Password</label>
                            <div class="password-input">
                                <input type="password" id="signupPassword" required>
                                <button type="button" class="show-password">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password</label>
                            <div class="password-input">
                                <input type="password" id="confirmPassword" required>
                                <button type="button" class="show-password">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="dob">Date of Birth</label>
                        <input type="date" id="dob" required>
                    </div>

                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" required>
                    </div>

                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="termsAgree" required>
                        <label for="termsAgree">I agree to the <a href="terms.html">Terms of Service</a> and <a href="privacy.html">Privacy Policy</a></label>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">Create Account</button>
                </form>
            </div>

            <!-- Forgot Password Modal -->
            <div class="modal" id="forgotPasswordModal">
                <div class="modal-content">
                    <button class="close-modal">&times;</button>
                    <h2>Reset Your Password</h2>
                    <p>Enter your email address to receive a password reset link</p>

                    <form id="forgotPasswordForm">
                        <div class="form-group">
                            <label for="resetEmail">Email Address</label>
                            <input type="email" id="resetEmail" required>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block">Send Reset Link</button>
                    </form>
                </div>
            </div>

            <!-- Portal Features -->
            <section class="portal-features">
                <h2>What You Can Do With Your Patient Portal</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <h3>Manage Appointments</h3>
                        <p>Schedule, reschedule or cancel appointments online</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-file-medical"></i>
                        </div>
                        <h3>View Medical Records</h3>
                        <p>Access your test results and health history</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-prescription-bottle-alt"></i>
                        </div>
                        <h3>Request Prescriptions</h3>
                        <p>Submit refill requests for your medications</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-comment-medical"></i>
                        </div>
                        <h3>Secure Messaging</h3>
                        <p>Communicate with your healthcare team</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <h3>Pay Bills Online</h3>
                        <p>View and pay your medical bills securely</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-user-edit"></i>
                        </div>
                        <h3>Update Information</h3>
                        <p>Keep your personal and insurance details current</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer Section -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-about">
                    <div class="logo">
                        <a href="index.html">
                            <h2>Zahari Medical</h2>
                            <span></span>
                        </a>
                    </div>
                    <p>Providing modern healthcare solutions with compassion and cutting-edge technology since 2010.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                
                <div class="footer-links">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="services.html">Services</a></li>
                        <li><a href="doctors.html">Doctors</a></li>
                        <li><a href="departments.html">Departments</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                
                <div class="footer-services">
                    <h3>Our Services</h3>
                    <ul>
                        <li><a href="services.html#cardiology">Cardiology</a></li>
                        <li><a href="services.html#neurology">Neurology</a></li>
                        <li><a href="services.html#orthopedics">Orthopedics</a></li>
                        <li><a href="services.html#pulmonology">Pulmonology</a></li>
                        <li><a href="services.html#pediatrics">Pediatrics</a></li>
                        <li><a href="services.html#radiology">Radiology</a></li>
                    </ul>
                </div>
                
                <div class="footer-contact">
                    <h3>Contact Us</h3>
                    <ul>
                        <li>
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Jomvu Narcol, Mombasa, KE</span>
                        </li>
                        <li>
                            <i class="fas fa-phone-alt"></i>
                            <span>+254 705058912</span>
                        </li>
                        <li>
                            <i class="fas fa-envelope"></i>
                            <span>info@zaharimedical.com</span>
                        </li>
                        <li>
                            <i class="fas fa-clock"></i>
                            <span>Mon-Fri: 8:00am - 7:00pm<br>Sat-Sun: 9:00am - 5:00pm</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; <span id="current-year"></span> Zahari Medical. All Rights Reserved.</p>
                <div class="footer-legal">
                    <a href="privacy.html">Privacy Policy</a>
                    <a href="terms.html">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>
        // Patient Portal Specific JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Toggle between login and signup forms
            const loginToggle = document.getElementById('loginToggle');
            const signupToggle = document.getElementById('signupToggle');
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');

            loginToggle.addEventListener('click', function() {
                this.classList.add('active');
                signupToggle.classList.remove('active');
                loginForm.classList.add('active');
                signupForm.classList.remove('active');
            });

            signupToggle.addEventListener('click', function() {
                this.classList.add('active');
                loginToggle.classList.remove('active');
                signupForm.classList.add('active');
                loginForm.classList.remove('active');
            });

            // Show/hide password functionality
            document.querySelectorAll('.show-password').forEach(button => {
                button.addEventListener('click', function() {
                    const input = this.previousElementSibling;
                    if (input.type === 'password') {
                        input.type = 'text';
                        this.innerHTML = '<i class="fas fa-eye-slash"></i>';
                    } else {
                        input.type = 'password';
                        this.innerHTML = '<i class="fas fa-eye"></i>';
                    }
                });
            });

            // Forgot password modal
            const forgotPasswordLink = document.querySelector('.forgot-password');
            const forgotPasswordModal = document.getElementById('forgotPasswordModal');
            const closeModal = document.querySelector('.close-modal');

            // Login Form Submission - Updated with better error handling
            document.getElementById('patientLoginForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const loginBtn = this.querySelector('button[type="submit"]');
                const originalBtnText = loginBtn.innerHTML;

                try {
                    // Show loading state
                    loginBtn.disabled = true;
                    loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';

                    const response = await fetch('/api/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email, password })
                    });

                    // First check if we got a response at all
                    if (!response) {
                        throw new Error('No response from server');
                    }

                    // Check if response is JSON
                    const contentType = response.headers.get('content-type');
                    if (!contentType || !contentType.includes('application/json')) {
                        const text = await response.text();
                        throw new Error(text || 'Invalid server response');
                    }

                    const data = await response.json();
                    
                    if (response.ok) {
                        // Store token in localStorage or cookies
                        if (data.token) {
                            localStorage.setItem('authToken', data.token);
                        }
                        
                        alert('Login successful!');
                        window.location.href = "patient-dashboard.html";
                    } else {
                        throw new Error(data.message || 'Login failed');
                    }
                } catch (error) {
                    console.error('Login Error:', error);
                    alert(error.message || 'An error occurred during login');
                } finally {
                    // Restore button state
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = originalBtnText;
                }
            });

            // Registration Form Submission - Updated with better error handling
            document.getElementById('patientSignupForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Validate passwords match
                if (document.getElementById('signupPassword').value !== 
                    document.getElementById('confirmPassword').value) {
                    alert('Passwords do not match!');
                    return;
                }

                const formData = {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    email: document.getElementById('signupEmail').value,
                    password: document.getElementById('signupPassword').value,
                    dob: document.getElementById('dob').value,
                    phone: document.getElementById('phone').value
                };

                const registerBtn = this.querySelector('button[type="submit"]');
                const originalBtnText = registerBtn.innerHTML;

                try {
                    // Show loading state
                    registerBtn.disabled = true;
                    registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Registering...';

                    const response = await fetch('/api/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });

                    // First check if we got a response at all
                    if (!response) {
                        throw new Error('No response from server');
                    }

                    // Check if response is JSON
                    const contentType = response.headers.get('content-type');
                    if (!contentType || !contentType.includes('application/json')) {
                        const text = await response.text();
                        throw new Error(text || 'Invalid server response');
                    }

                    const data = await response.json();
                    
                    if (response.ok) {
                        alert('Registration successful! Please login.');
                        // Switch to login form
                        loginToggle.click();
                        // Clear form
                        this.reset();
                    } else {
                        throw new Error(data.message || 'Registration failed');
                    }
                } catch (error) {
                    console.error('Registration Error:', error);
                    alert(error.message || 'An error occurred during registration');
                } finally {
                    // Restore button state
                    registerBtn.disabled = false;
                    registerBtn.innerHTML = originalBtnText;
                }
            });

            // Forgot password modal handling
            if (forgotPasswordLink && forgotPasswordModal && closeModal) {
                forgotPasswordLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    forgotPasswordModal.style.display = 'block';
                });

                closeModal.addEventListener('click', function() {
                    forgotPasswordModal.style.display = 'none';
                });

                window.addEventListener('click', function(e) {
                    if (e.target === forgotPasswordModal) {
                        forgotPasswordModal.style.display = 'none';
                    }
                });
            }
        });
    </script>
</body>
</html>